<link rel="stylesheet" href="/css/cms/form.css">
<link rel="stylesheet" href="/css/cms/about.css">

<%- include('./partials/image-browser.ejs') %>

<article class="about-me">
    <div class="container-text">
        <form action="/api/about?_method=PATCH" method="POST">
            <div class="about-preview hidden"></div>

            <div class="about-edit">

                <div class="form-group">
                    <label for="greeting">Greeting</label>
                    <input required type="text" name="greeting" id="greeting" value="<%= about.greeting %>" >
                </div>
                <div class="form-group">
                    <label for="image">Image</label>
                    <div class="wrapper-horizontal flex-align-btm">
                        <div class="wrapper-vertical flex-grow">
                            <div id="change-image-btn" class="btn btn-dark">Change image</div>
                            <input required type="text" name="image" id="image" value="<%=about.image %>">
                        </div>
                        <div class="about-image-container">
                            <img class="project-image" src="<%=about.image%>" alt="">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="bio">Short bio</label>
                    <textarea name="bio" id="bio"><%= about.bio %></textarea>
                </div>
                <div class="form-group">
                    <label for="mainMD">Main about</label>
                    <textarea required name="mainMD" id="main-about"><%= about.main %></textarea>
                </div>

            </div>
            <div class="btn-wrapper">
                <button type="submit" class="btn btn-dark">Save</button>
                <div id="preview-btn" class="btn btn-toggle">Preview</div>
                <a href="/cms/projects" class="btn btn-light">Cancel</a>
            </div>
        </form>
    </div>

</article>


<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    // preview toggle
    let preview_btn = document.getElementById('preview-btn');
    let preview_window = document.querySelector('.about-preview');
    preview_btn.addEventListener('click', event => {
        if (event.target.innerHTML == "Edit") {
            preview_btn.innerHTML = "Preview";
            document.querySelector('.about-preview').classList.add('hidden');
            document.querySelector('.about-edit').classList.remove('hidden');
            while(preview_window.firstChild) {
                preview_window.removeChild(preview_window.lastChild);
            }
        } else if(event.target.innerHTML =="Preview") {
            preview_btn.innerHTML = "Edit";
            document.querySelector('.about-preview').classList.remove('hidden');
            document.querySelector('.about-edit').classList.add('hidden');

            let headerdiv = document.createElement('div');
            headerdiv.classList.add('about-header');
            let title = document.createElement('h1');
            title.innerHTML = document.querySelector('input#greeting').value;
            headerdiv.appendChild(title);
            preview_window.appendChild(headerdiv);

            let contentdiv = document.createElement('div');
            contentdiv.classList.add('about-content');
            contentdiv.innerHTML = marked(document.querySelector('textarea#content').value);
            preview_window.appendChild(contentdiv);
        }
    });
</script>
